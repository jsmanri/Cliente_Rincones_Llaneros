<div *ngIf="loading" class="loading-container">
  <mat-spinner></mat-spinner>
</div>

<div class="logout-container">
  <button mat-raised-button color="warn" (click)="cerrarSesion()">
    <mat-icon>logout</mat-icon> Cerrar Sesión
  </button>
</div>


<div *ngIf="!loading" class="container">
  <!-- Contador de usuarios -->
  <div class="item">
    <mat-card class="content">
      <h2>Total Usuarios</h2>
      <p class="item-desc">
        Esta es la cantidad de clientes y vendedores que se han registrado en la página.
      </p>
      <div class="counter">{{ data?.TotalUsuarios }}</div>
    </mat-card>
  </div>

  <!-- Gráfica Pie (Roles) -->
  <div class="item">
    <mat-card class="content">
      <h2>Usuarios por Rol</h2>
      <p class="item-desc">
        Distribución de usuarios según su rol (cliente, vendedor, etc.).
      </p>
      <canvas baseChart
        [data]="rolesChartData"
        [type]="'pie'">
      </canvas>
    </mat-card>
  </div>

  <!-- Gráfica Barras (Usuarios por Fecha) -->
  <div class="item">
    <mat-card class="content">
      <h2>Usuarios Registrados por Mes</h2>
      <p class="item-desc">
        Usuarios registrados por mes y segun el año.
      </p>

      <!-- Botones de navegación de años -->
      <div class="year-selector">
        <button mat-icon-button (click)="cambiarAnio(-1)" aria-label="Año anterior">
          <mat-icon>chevron_left</mat-icon>
        </button>
        <span class="year-label">{{ selectedYear }}</span>
        <button mat-icon-button (click)="cambiarAnio(1)" aria-label="Año siguiente">
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>

      <!-- Gráfica -->
      <canvas baseChart
        [data]="usuariosPorFechaChartData"
        [options]="barChartOptions"
        [type]="'bar'">
      </canvas>
    </mat-card>
  </div>

  <!-- Lista de Usuarios -->
  <div class="item">
    <mat-card class="content">
      <h2>Lista de Usuarios</h2>
      <p class="item-desc">
        Aquí puedes activar o desactivar usuarios segun el Rol Vendedor (v) o Cliente (C)
      </p>
      <!-- Filtro de búsqueda -->
      <div class="filter-row">
      <mat-form-field class="search-input" appearance="outline">
        <mat-label>Buscar usuario</mat-label>
        <input matInput [(ngModel)]="searchText" placeholder="Escribe un nombre">
      </mat-form-field>

      <div class="rol-filters">
        <button mat-raised-button
          class="vendedor-btn"
          [ngClass]="{ 'activo': selectedRol === 'vendedor', 'inactivo': selectedRol !== 'vendedor' }"
          (click)="cambiarRol('vendedor')">
          V
        </button>
      </div>

      <button mat-raised-button
        class="cliente-btn"
        [ngClass]="{ 'activo': selectedRol === 'cliente', 'inactivo': selectedRol !== 'cliente' }"
        (click)="cambiarRol('cliente')">
        C
      </button>
      </div>

      <!-- Lista de usuarios -->
      <div class="user-list">
        <div class="user" *ngFor="let usuario of filteredUsuarios">
          <span>{{ usuario.Nombre }}</span>
          <mat-slide-toggle [checked]="usuario.Activo" (change)="toggleActivo(usuario)">
          </mat-slide-toggle>
        </div>
        <div *ngIf="filteredUsuarios.length === 0" class="no-users-msg">
          <span>No hay usuarios para mostrar.</span>
        </div>
      </div>
    </mat-card>
  </div>
</div>
