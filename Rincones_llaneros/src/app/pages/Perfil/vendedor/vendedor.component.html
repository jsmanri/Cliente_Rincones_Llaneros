<ng-template #cargando>
  <p>Cargando perfil del vendedor...</p>
</ng-template>

<div class="perfil-container" *ngIf="vendedor; else cargando">
  <!-- ENCABEZADO DEL VENDEDOR -->
  <div class="perfil-header">
    <div class="foto-perfil">
      <img [src]="vendedor.FotoPerfil?.url || 'assets/default-profile.jpg'" alt="Foto de perfil" />
    </div>
    <div class="info-basica">
      <h1>{{ vendedor.Nombre }}</h1>
      <p><strong>Email:</strong> {{ vendedor.Correo }}</p>
      <p><strong>Tel√©fono:</strong> {{ vendedor.NumeroTelefono }}</p>
    </div>
  </div>

  <!-- TABS -->
  <div class="tabs">
    <button [class.activo]="tabActivo === 'publicaciones'" (click)="cambiarTab('publicaciones')">Sitios</button>
    <button [class.activo]="tabActivo === 'eventos'" (click)="cambiarTab('eventos')">Eventos</button>
    <button [class.activo]="tabActivo === 'info'" (click)="cambiarTab('info')">Informaci√≥n</button>
    

  </div>

  <!-- TAB DE PUBLICACIONES -->
  <div *ngIf="tabActivo === 'publicaciones'">
    <h2>Publicaciones</h2>
<div class="publicacion-card" *ngFor="let sitio of publicaciones">
  <div class="menu-opciones">
    <button class="btn-menu" (click)="sitio.menuAbierto = !sitio.menuAbierto">
      &#8942;
    </button>
    <div class="menu-desplegable" *ngIf="sitio.menuAbierto">
      <button class="opcion-editar" (click)="sitio.editando = true; sitio.menuAbierto = false">Editar</button>
      <button class="opcion-eliminar" (click)="eliminarPublicacion(sitio)">Eliminar</button>
    </div>
  </div>

      <!-- MODO EDICI√ìN -->
      <div *ngIf="sitio.editando; else vistaNormal" class="editar-publicacion-container">
        <h3>Editar publicaci√≥n</h3>

        <label>Nombre:</label>
        <input [(ngModel)]="sitio.NombreSitioTuristico" placeholder="Nombre del sitio" />

        <label>Descripci√≥n:</label>
        <textarea [(ngModel)]="sitio.DescripcionSitioTuristico" placeholder="Descripci√≥n detallada"></textarea>

        <label>Ubicaci√≥n:</label>
        <input [(ngModel)]="sitio.Ubicacion" placeholder="Ubicaci√≥n del sitio" />

        <label>Horario:</label>
        <input [(ngModel)]="sitio.Horario" placeholder="Horario de atenci√≥n" />

        <label>Imagen:</label>
        <input type="file" (change)="procesarImagen($event, sitio)" />

        <div *ngIf="sitio.Fotos && sitio.Fotos.length" class="preview-imagen-edicion">
          <img [src]="sitio.Fotos[0]" alt="Foto del sitio" />
        </div>

        <div class="botones-edicion">
          <button class="btn-guardar" (click)="guardarCambios(sitio)">üíæ Guardar</button>
          <button class="btn-cancelar" (click)="sitio.editando = false">‚ùå Cancelar</button>
        </div>
      </div>

      <!-- MODO VISTA -->
      <ng-template #vistaNormal>
        <div class="contenido-principal">
          <h3>{{ sitio.NombreSitioTuristico }}</h3>

          <div class="imagen-grande">
            <img [src]="sitio.Fotos[0]" alt="Foto del sitio" />
          </div>

          <p>{{ sitio.DescripcionSitioTuristico }}</p>
        </div>

        <button (click)="sitio.mostrarDetalles = !sitio.mostrarDetalles" class="btn-mas">
          {{ sitio.mostrarDetalles ? 'Ocultar informaci√≥n' : 'M√°s informaci√≥n' }}
        </button>

        <div *ngIf="sitio.mostrarDetalles" class="detalles-adicionales">
          <p><strong>Ubicaci√≥n:</strong> {{ sitio.Ubicacion }}</p>
          <p><strong>Horario:</strong> {{ sitio.Horario }}</p>
          <p><strong>Municipio:</strong> {{ sitio.IdMunicipio?.NombreMunicipio }}</p>
          <p><strong>Categor√≠a:</strong> {{ sitio.IdCategoria?.Nombre }}</p>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- TAB DE INFORMACI√ìN -->
<div *ngIf="tabActivo === 'info'">
  <h2>Informaci√≥n adicional</h2>

  <!-- Modo Edici√≥n -->
  <div *ngIf="editandoVendedor; else vistaVendedor">
    <label>Nombre:</label>
    <input [(ngModel)]="vendedor.Nombre" type="text" />

    <label>Email:</label>
    <input [(ngModel)]="vendedor.Correo" type="email" />

    <label>Tel√©fono:</label>
    <input [(ngModel)]="vendedor.NumeroTelefono" type="text" />

    <div class="botones-edicion">
      <button class="btn-guardar" (click)="guardarInfoVendedor()">üíæ Guardar</button>
      <button class="btn-cancelar" (click)="editandoVendedor = false">‚ùå Cancelar</button>
    </div>
  </div>

  <!-- Modo Vista -->
  <ng-template #vistaVendedor>
    <p><strong>Nombre:</strong> {{ vendedor.Nombre }}</p>
    <p><strong>Email:</strong> {{ vendedor.Correo }}</p>
    <p><strong>Tel√©fono:</strong> {{ vendedor.NumeroTelefono }}</p>
    <p><strong>C√©dula:</strong> {{ vendedor.Cedula }}</p>
    <p><strong>Fecha creaci√≥n:</strong> {{ vendedor.FechaCreacion | date:'medium' }}</p>
    <p><strong>Activo:</strong> {{ vendedor.Activo ? 'S√≠' : 'No' }}</p>

    <button class="btn-editar" (click)="editandoVendedor = true">‚úèÔ∏è Editar informaci√≥n</button>
  </ng-template>
</div>

<!-- TAB DE EVENTOS -->
<div *ngIf="tabActivo === 'eventos'">
  <h2>Eventos publicados</h2>
  <div class="publicacion-card" *ngFor="let evento of eventos">

    <!-- MEN√ö DE TRES PUNTOS -->
    <div class="menu-opciones">
      <button class="btn-menu" (click)="evento.menuAbierto = !evento.menuAbierto">
        &#8942;
      </button>
      <div class="menu-desplegable" *ngIf="evento.menuAbierto">
        <button class="opcion-editar" (click)="evento.editando = true; evento.menuAbierto = false">Editar</button>
        <button class="opcion-eliminar" (click)="eliminarEvento(evento)">Eliminar</button>
      </div>
    </div>

    <div *ngIf="evento.editando; else vistaEvento" class="editar-publicacion-container">
      <h3>Editar evento</h3>

      <label>Nombre:</label>
      <input [(ngModel)]="evento.NombreEvento" placeholder="Nombre del evento" />

      <label>Descripci√≥n:</label>
      <textarea [(ngModel)]="evento.DescripcionEvento" placeholder="Descripci√≥n del evento"></textarea>

      <label>Fecha:</label>
      <input type="date" [(ngModel)]="evento.FechaEvento" />

      <label>Ubicaci√≥n:</label>
      <input [(ngModel)]="evento.Ubicacion" placeholder="Ubicaci√≥n" />

      <label>Imagen:</label>
      <input type="file" (change)="procesarImagenEvento($event, evento)" />
      <div *ngIf="evento.Fotos?.length" class="preview-imagen-edicion">
        <img [src]="evento.Fotos[0]" alt="Imagen del evento" />
      </div>

      <div class="botones-edicion">
        <button class="btn-guardar" (click)="guardarCambiosEvento(evento)">üíæ Guardar</button>
        <button class="btn-cancelar" (click)="evento.editando = false">‚ùå Cancelar</button>
      </div>
    </div>

    <ng-template #vistaEvento>
      <h3>{{ evento.NombreEvento }}</h3>
      <div class="imagen-grande">
        <img [src]="evento.Fotos[0]" alt="Imagen del evento" />
      </div>
      <p>{{ evento.DescripcionEvento }}</p>
      <p><strong>Fecha:</strong> {{ evento.FechaEvento | date:'longDate' }}</p>
      <p><strong>Ubicaci√≥n:</strong> {{ evento.Ubicacion }}</p>
    </ng-template>
  </div>
</div>




  <!-- TAB DE INFORMACI√ìN -->
  <div *ngIf="tabActivo === 'info'">
    <h2>Informaci√≥n adicional</h2>
    <p><strong>C√©dula:</strong> {{ vendedor.Cedula }}</p>
    <p><strong>Fecha creaci√≥n:</strong> {{ vendedor.FechaCreacion | date:'medium' }}</p>
    <p><strong>Activo:</strong> {{ vendedor.Activo ? 'S√≠' : 'No' }}</p>
  </div>
</div>
