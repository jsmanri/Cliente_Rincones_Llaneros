<ng-template #cargando>
  <p>Cargando perfil del vendedor...</p>
</ng-template>

<div class="perfil-container" *ngIf="vendedor; else cargando">
  <!-- ENCABEZADO DEL VENDEDOR -->
  <div class="perfil-header">
    <div class="foto-perfil">
    <!-- Plantilla HTML -->


<!-- Vista previa -->
<img *ngIf="vendedor.FotoPreview || vendedor.FotoPerfil" [src]="vendedor.FotoPreview || vendedor.FotoPerfil" alt="Foto de perfil" width="150" />
    </div>
    <div class="info-basica">
      <h1>{{ vendedor.Nombre }}</h1>
      <p><strong>Email:</strong> {{ vendedor.Correo }}</p>
      <p><strong>Tel√©fono:</strong> {{ vendedor.NumeroTelefono }}</p>
    </div>
  </div>

  <!-- TABS -->
  <div class="tabs">
    <button [class.activo]="tabActivo === 'publicaciones'" (click)="cambiarTab('publicaciones')">Sitios</button>
    <button [class.activo]="tabActivo === 'eventos'" (click)="cambiarTab('eventos')">Eventos</button>
    <button [class.activo]="tabActivo === 'info'" (click)="cambiarTab('info')">Informaci√≥n</button>
    

  </div>

  <!-- Bot√≥n de Publicar -->
<!-- Bot√≥n para mostrar/ocultar la card -->
<button (click)="mostrarCardPublicar = !mostrarCardPublicar" class="btn-publicar">
   ¬øAgregar nuevo sitio?
</button>

<!-- Card con opciones -->
<div *ngIf="mostrarCardPublicar" class="card-publicar">
  <h3>¬øQu√© deseas publicar?</h3>
  <div class="opciones-publicar">
    <button (click)="publicarSitio()" class="btn-opcion">üèû Publicar sitio</button>
    <button (click)="publicarEvento()" class="btn-opcion">üéâ Publicar evento</button>
  </div>
</div>



  <!-- TAB DE PUBLICACIONES -->
  <div *ngIf="tabActivo === 'publicaciones'">
    <h2>Publicaciones</h2>
<div class="publicacion-card" *ngFor="let sitio of publicaciones">
  <div class="menu-opciones">
    <button class="btn-menu" (click)="sitio.menuAbierto = !sitio.menuAbierto">
      &#8942;
    </button>
    <div class="menu-desplegable" *ngIf="sitio.menuAbierto">
      <button class="opcion-editar" (click)="sitio.editando = true; sitio.menuAbierto = false">Editar</button>
      <button class="opcion-eliminar" (click)="eliminarPublicacion(sitio)">Eliminar</button>
    </div>
  </div>

      <!-- MODO EDICI√ìN -->
      <div *ngIf="sitio.editando; else vistaNormal" class="editar-publicacion-container">
        <h3>Editar publicaci√≥n</h3>

        <label>Nombre:</label>
        <input [(ngModel)]="sitio.NombreSitioTuristico" placeholder="Nombre del sitio" />

        <label>Descripci√≥n:</label>
        <textarea [(ngModel)]="sitio.DescripcionSitioTuristico" placeholder="Descripci√≥n detallada"></textarea>

        <label>Ubicaci√≥n:</label>
        <input [(ngModel)]="sitio.Ubicacion" placeholder="Ubicaci√≥n del sitio" />

        <label>Horario:</label>
        <input [(ngModel)]="sitio.Horario" placeholder="Horario de atenci√≥n" />

        <label>Im√°genes:</label>
        <div *ngFor="let foto of sitio.Fotos; let i = index">
        <img [src]="foto" width="150" />
        <input type="file" (change)="reemplazarImagen($event, i, sitio)" />
        </div>
        <div *ngIf="sitio.Fotos.length < 5">
        <input type="file" multiple (change)="agregarImagenes($event, sitio)" />
        </div>





        <div class="botones-edicion">
          <button class="btn-guardar" (click)="guardarCambios(sitio)">üíæ Guardar</button>
          <button class="btn-cancelar" (click)="sitio.editando = false">‚ùå Cancelar</button>
        </div>
      </div>

      <!-- MODO VISTA -->
      <ng-template #vistaNormal>
        <div class="contenido-principal">
          <h3>{{ sitio.NombreSitioTuristico }}</h3>

         <div class="slider-imagenes">
         <img [src]="sitio.Fotos[sitio.indiceImagenActual || 0]" alt="Foto del sitio" class="imagen-publicacion" />

         <div class="botones-navegacion">
         <button (click)="anteriorImagen(sitio)">&#8592; Anterior</button>
         <button (click)="siguienteImagen(sitio)">Siguiente &#8594;</button>
         </div>
         </div>




          <p>{{ sitio.DescripcionSitioTuristico }}</p>
        </div>

        <button (click)="sitio.mostrarDetalles = !sitio.mostrarDetalles" class="btn-mas">
          {{ sitio.mostrarDetalles ? 'Ocultar informaci√≥n' : 'M√°s informaci√≥n' }}
        </button>

        <div *ngIf="sitio.mostrarDetalles" class="detalles-adicionales">
          <p><strong>Ubicaci√≥n:</strong> {{ sitio.Ubicacion }}</p>
          <p><strong>Horario:</strong> {{ sitio.Horario }}</p>
          <p><strong>Municipio:</strong> {{ sitio.IdMunicipio?.NombreMunicipio }}</p>
          <p><strong>Categor√≠a:</strong> {{ sitio.IdCategoria?.Nombre }}</p>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- TAB DE INFORMACI√ìN -->
<div *ngIf="tabActivo === 'info'">
  <h2>Informaci√≥n adicional</h2>

  <!-- Modo Edici√≥n -->
  <div *ngIf="editandoVendedor; else vistaVendedor" class="editar-vendedor-form">
  <label>Nombre:</label>
  <input [(ngModel)]="vendedor.Nombre" type="text" />

  <label>Email:</label>
  <input [(ngModel)]="vendedor.Correo" type="email" />

  <label>Tel√©fono:</label>
  <input [(ngModel)]="vendedor.NumeroTelefono" type="text" />

  <label>Foto de perfil:</label>
  <input type="file" (change)="cambiarFoto($event)" accept="image/*" />

  <div *ngIf="vendedor.FotoPerfil" class="preview-imagen-edicion">
    <img [src]="vendedor.FotoPerfil" alt="Foto de perfil" />
  </div>

  <div class="botones-edicion">
    <button class="btn-guardar" (click)="guardarInfoVendedor()">üíæ Guardar</button>
    <button class="btn-cancelar" (click)="editandoVendedor = false">‚ùå Cancelar</button>
  </div>
</div>


  <!-- Modo Vista -->
  <ng-template #vistaVendedor>
    <p><strong>Nombre:</strong> {{ vendedor.Nombre }}</p>
    <p><strong>Email:</strong> {{ vendedor.Correo }}</p>
    <p><strong>Tel√©fono:</strong> {{ vendedor.NumeroTelefono }}</p>
    <p><strong>Fecha creaci√≥n:</strong> {{ vendedor.FechaCreacion | date:'medium' }}</p>
    <p><strong>Activo:</strong> {{ vendedor.Activo ? 'S√≠' : 'No' }}</p>

    <button class="btn-editar" (click)="editandoVendedor = true">‚úèÔ∏è Editar informaci√≥n</button>
  </ng-template>
</div>

<!-- TAB DE EVENTOS -->
<div *ngIf="tabActivo === 'eventos'">
  <h2>Eventos publicados</h2>
  <div class="publicacion-card" *ngFor="let evento of eventos">

    <!-- MEN√ö DE TRES PUNTOS -->
    <div class="menu-opciones">
      <button class="btn-menu" (click)="evento.menuAbierto = !evento.menuAbierto">
        &#8942;
      </button>
      <div class="menu-desplegable" *ngIf="evento.menuAbierto">
        <button class="opcion-editar" (click)="evento.editando = true; evento.menuAbierto = false">Editar</button>
        <button class="opcion-eliminar" (click)="eliminarEvento(evento)">Eliminar</button>
      </div>
    </div>

    <!-- MODO EDICI√ìN -->
    <div *ngIf="evento.editando; else vistaEvento" class="editar-publicacion-container">
      <h3>Editar evento</h3>

      <label>Nombre:</label>
      <input [(ngModel)]="evento.NombreEvento" placeholder="Nombre del evento" />

      <label>Descripci√≥n:</label>
      <textarea [(ngModel)]="evento.DescripcionEvento" placeholder="Descripci√≥n del evento"></textarea>

      <label>Fecha:</label>
      <input type="date" [(ngModel)]="evento.FechaEvento" />

      <label>Ubicaci√≥n:</label>
      <input [(ngModel)]="evento.Ubicacion" placeholder="Ubicaci√≥n" />

      <label>Im√°genes (m√°ximo 3):</label>
      <div *ngFor="let foto of evento.Fotos; let i = index" class="imagen-reemplazo-container">
        <img [src]="foto" alt="Imagen del evento" width="150" />
        <input type="file" (change)="reemplazarImagenEvento($event, i, evento)" />
      </div>

      <!-- Solo mostrar input para agregar im√°genes si hay menos de 3 -->
      <div *ngIf="(evento.Fotos?.length || 0) < 3">
        <input type="file" multiple (change)="agregarImagenesEvento($event, evento)" />
      </div>

      <div class="botones-edicion">
        <button class="btn-guardar" (click)="guardarCambiosEvento(evento)">üíæ Guardar</button>
        <button class="btn-cancelar" (click)="evento.editando = false">‚ùå Cancelar</button>
      </div>
    </div>

    <!-- MODO VISTA -->
    <ng-template #vistaEvento>
      <h3>{{ evento.NombreEvento }}</h3>
      
      <!-- SLIDER DE IM√ÅGENES -->
      <!-- SLIDER DE IM√ÅGENES -->
<div class="slider-imagenes" *ngIf="evento.Fotos?.length > 0">
  <img 
    [src]="evento.Fotos[evento.indiceImagenActual || 0]" 
    alt="Imagen del evento" 
    class="imagen-publicacion"
  />

  <div class="botones-navegacion">
    <button (click)="cambiarImagenEvento(evento, -1)">&#8592; Anterior</button>
    <button (click)="cambiarImagenEvento(evento, 1)">Siguiente &#8594;</button>
  </div>
</div>


      <p>{{ evento.DescripcionEvento }}</p>
      <p><strong>Fecha:</strong> {{ evento.FechaEvento | date:'longDate' }}</p>
      <p><strong>Ubicaci√≥n:</strong> {{ evento.Ubicacion }}</p>
    </ng-template>
  </div>
</div>





  <!-- TAB DE INFORMACI√ìN -->
  <div *ngIf="tabActivo === 'info'">
    <h2>Informaci√≥n adicional</h2>
    <p><strong>C√©dula:</strong> {{ vendedor.Cedula }}</p>
    <p><strong>Fecha creaci√≥n:</strong> {{ vendedor.FechaCreacion | date:'medium' }}</p>
    <p><strong>Activo:</strong> {{ vendedor.Activo ? 'S√≠' : 'No' }}</p>
    
  </div>
</div>
